<!DOCTYPE html>

<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name='viewport' content='width=device-width, initial-scale=1' />

<link href="./css/bootstrap3/css/bootstrap.min.css" rel="stylesheet">
<link href="./css/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link href="./css/teacher_home.css" rel="stylesheet">


<title>教师主页</title>
</head>

<body>
<div class='container-fluid'>
    <nav class="navbar navbar-default navbar-fixed-top hidden-md hidden-lg" role="navigation">
        <div class='container-fluid'>
            <div class='navbar-header'>
                <button type='button' class='navbar-toggle' data-toggle='collapse' data-target='#example'>
                    <span class="icon-bar" style='color:black;'></span>
                    <span class="icon-bar" style='color:black;'></span>
                    <span class="icon-bar" style='color:black;'></span>
                </button>
 　             <a class="navbar-brand" href="#">
                    主页
                </a>
 　         </div>
            <div class="collapse navbar-collapse navbar-right is-collapse" id='example'>
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#"><span class='glyphicon glyphicon-home'></span>&emsp;主页</a></li>
                    <li><a href="#"><span class='glyphicon glyphicon-picture'></span>&emsp;图表</a></li>
                    <li><a href="#"><span class='glyphicon glyphicon-comment'></span>&emsp;聊天</a></li>
                    <li><a href="#"><span class='glyphicon glyphicon-cog'></span>&emsp;设置</a></li>
                    <li><a href="#"><span class='glyphicon glyphicon-upload'></span>&emsp;上传</a></li>
                    <li><a href="#"><span class='glyphicon glyphicon-download'></span>&emsp;下载</a></li>
                </ul>
            </div>
        </div>
    </nav>
        <div class='row'>
            <div class='col-md-2 col-sm-2 col-xs-2 hidden-sm hidden-xs'>
                <nav class='navbar navbar-default navbar-fixed-top' style='width:14%;top:1%;left:1%;padding:2px'>
                <div class='container-fluid'>
                    <div class='navbar-header'>
                        <button class='navbar-toggle collapsed' data-toggle='collapse' data-target='#sidebar-navbar-collapse'>
                        <span class='icon-bar'></span><span class='icon-bar'></span><span class='icon-bar'></span>
                        </button>
                    </div>
                    <div class='navbar-collapse collapse' id='sidebar-navbar-collapse'>
                        <ul class='nav nav-stacked'>
                            <li><a href='#' class='btn btn-success'><span class='glyphicon glyphicon-home pull-left'></span><span class='pull-left'>&emsp;主页</span>&emsp;</a></li>
                            <li><a href='#' class='btn btn-link'><span class='glyphicon glyphicon-picture pull-left'></span><span class='pull-left'>&emsp;图表</span>&emsp;</a></li>
                            <li><a href='#' class='btn btn-link'><span class='glyphicon glyphicon-comment pull-left'></span><span class='pull-left'>&emsp;聊天</span>&emsp;</a></li>
                            <li><a href='#' class='btn btn-link'><span class='glyphicon glyphicon-cog pull-left'></span><span class='pull-left'>&emsp;设置</span>&emsp;</a></li>
                            <li><a href='#' class='btn btn-link'><span class='glyphicon glyphicon-upload pull-left'></span><span class='pull-left'>&emsp;上传</span>&emsp;</a></li>
                            <li><a href='#' class='btn btn-link'><span class='glyphicon glyphicon-download pull-left'></span><span class='pull-left'>&emsp;下载</span>&emsp;</a></li>
                        </ul>
                    </div>
                </div>
                </nav>
            </div>

            <div class='col-md-10 col-sm-10 col-xs-10' style='padding:40px;'>
            <h2 style='display:inline;'><i class='fa  fa-group'></i>&emsp;人员名单</h2>
            <button class='btn btn-default' id='all-refresh'><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button>
            <div>
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>姓名</th>
                            <th>姓名</th>
                            <th>姓名</th>
                            <th>姓名</th>
                            <th>姓名</th>
                            <th>姓名</th>
                            <th>姓名</th>
                            <th>姓名</th>
                            <th>姓名</th>
                            <th>姓名</th>
                        </tr>
                    </thead>
                    <tbody id='all-list'>
                    </tbody>
                </table>
            </div>
            <hr />
            <h2><span class='glyphicon glyphicon-picture'></span>&emsp;图表</h2>
            <div class='row'>
                <div class='col-md-12 col-sm-12 col-xs-12'>
                    <div style='padding:10px;'><div style='width:100%;height:500px;' id='chart1'></div></div>
                </div>
                <div class='col-md-6 col-sm-6 col-xs-12'>
                    <div class='panel panel-default' style='width:100%;height:300px;' id='chart2'>
                        <div class='panel-heading' style='height:80px;'>
                            <h3><i class='fa fa-hand-peace-o'></i>&emsp;到课率较高的学生</h3>
                        </div>
                        <div class='panel-body' style='height:220px;overflow:auto;'>
                            <ul class='list-group'>
                                <li class="list-group-item">
                                    
                                </li>
                                <li class="list-group-item">
                                    
                                </li>
                                <li class="list-group-item">
                                    
                                </li>
                                <li class="list-group-item">
                                    
                                </li>
                                <li class="list-group-item">
                                    
                                </li>
                                <li class="list-group-item">
                                    
                                </li>
                                <li class="list-group-item">
                                    
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class='col-md-6 col-sm-6 col-xs-12'>
                    <div class='panel panel-default' style='width:100%;height:300px;' id='chart3'>
                        <div class='panel-heading' style='height:80px;'>
                            <h3><span class='glyphicon glyphicon-comment'></span>&emsp;想说的话</h3>
                        </div>
                        <div class='panel-body' style='height:220px;overflow:auto;'>
                            <ul class='list-group'>
                                <li class="list-group-item"></li>
                                <li class="list-group-item"></li>
                                <li class="list-group-item"></li>
                                <li class="list-group-item"></li>
                                <li class="list-group-item"></li>
                                <li class="list-group-item"></li>
                                <li class="list-group-item"></li>
                                <li class="list-group-item"></li>
                                <li class="list-group-item"></li>
                                <li class="list-group-item"></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <hr />
            <h2 style='display:inline;'><i class='fa fa-user-times'></i>&emsp;未签到人员名单</h2>
            <button class='btn btn-default' id='no-refresh'><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button>
            <div>
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>姓名</th>
                            <th>到课情况</th>
                        </tr>
                    </thead>
                    <tbody id='no-list'>
                    </tbody>
                </table>
            </div>
            </div>
        </div>
</div>

<script src="./js/jquery.js"></script>
<script src="./css/bootstrap3/js/bootstrap.min.js"></script>
<script src='./js/highcharts/highcharts.js'></script>
<script>

    
    //对学生名单以及未到学生名单的展示
    var object_js;
    var s=new Array();
    s.push('btn-danger');
    s.push('btn-success');
    var allList=document.getElementById('all-list');
    
    var object_no;
    var noList=document.getElementById('no-list');
    
    
    //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    function check_stu(){
        $.ajax({
            url: './returnJSON.php', //在这里提填写你的地址
            async: true,
            dataType: 'text',
            success: function (json_str) {
                object_js=JSON.parse(json_str);
                showAllList();
            }  
        });
    }
    
    
    function showAllList(){
        $('#all-list tr').remove();
        var size=0,key;
        var statuses=new Array();
        var names=new Array();
        for(key in object_js){
            if(object_js.hasOwnProperty(key)){
                names.push(key);
                statuses.push(object_js[key]);
                size++;
            }
        }
        var i=0;
        for(i=0;i<size;){
            var tr=document.createElement('tr');
            do{
                if(i>=size){
                    break;
                }
                var td=document.createElement('td');
                var btn=document.createElement('a');
                $(btn).html("<span class='glyphicon glyphicon-user pull-right'></span>"+names[i]);
                $(btn).attr('href','#');
                $(btn).addClass('btn');
                $(btn).css('width','100px');
                $(btn).addClass(s[statuses[i]]);
                td.appendChild(btn);
                tr.appendChild(td);
                i++;
            }while(i%10!=0);
            allList.appendChild(tr);
        }
    }
    
    
    check_stu();
    
    
    //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    setInterval('check_stu()',60000);//6000是间隔时间  单位为毫秒 6000就是一分钟
    
    
    function check_stu_no(){
        $.ajax({
            url: './returnJSON.php',
            async: true,
            dataType: 'text',
            success: function (json_str) {
                object_no=JSON.parse(json_str);
                showNoList();
            }  
        });
    }
    
    function showNoList(){
        $('#no-list tr').remove();
        var size=0;
        var names=new Array();
        for(var key in object_no){
            if(object_no.hasOwnProperty(key)){
                if(object_no[key]==0){
                    names.push(key);
                    size++;
                }
            }
        
        }
        for(var i=0;i<size;i++){
            var tr=document.createElement('tr');
            var td1=document.createElement('td');
            var td2=document.createElement('td');
            $(tr).addClass('danger');
            td1.innerHTML=names[i];
            td2.innerHTML='未签到';
            tr.appendChild(td1);
            tr.appendChild(td2);
            noList.appendChild(tr);
        }
    }
    
    check_stu_no()
    setInterval('check_stu_no()',60000);
    
    var allRefresh=$('#all-refresh');
    var noRefresh=$('#no-refresh');
    allRefresh.click(function(){check_stu();});
    noRefresh.click(function(){check_stu_no();});
    
    //对三个图表的展示
    
    //第一个图
    var data_avg=new Array();//平均到课率
    var data_my=new Array();//老师自己的课的到课率
    
    function classPercentage_avg(){
        $.ajax({
            url: './returnJSON_per.php', //在这里提填写你的地址
            async: true,
            dataType: 'text',
            success: function (json_str) {
                var json_obj=JSON.parse(json_str);
                for(var i in json_obj){
                    data_avg.push(json_obj[i]);
                }
                classPercentage_my();
            }  
        });
    }
    
    function classPercentage_my(){
        $.ajax({
            url: './returnJSON_permy.php', //在这里提填写你的地址
            async: true,
            dataType: 'text',
            success: function (json_str) {
                var json_obj=JSON.parse(json_str);
                for(var i in json_obj){
                    data_my.push(json_obj[i]);
                }
                draw_chart();
            }  
        });
    }
    classPercentage_avg();
    
    
    function draw_chart(){
        $('#chart1').highcharts({
            title:{
                text:"到课率"
            },
            xAxis: {
                title:{
                    text:'周数'
                },
                categories: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]
            },
            yAxis:{
                title:{
                    text:'到课百分比'
                }
            },
            plotOptions: {
                series: {
                    dataLabels: {
                        enabled: true,
                        format: '{y}%',
                    }
                }
            },
            series: [{
                name:'平均到课率',
                data: data_avg
            },
            {
                name:"您的到课率",
                data:data_my
            }]
        });
    }
    
    //到课率较高的学生
    var hrefs=new Array();
    var names=new Array();
    var stus_good=$('#chart2 ul.list-group li.list-group-item');
    
    function suggestStu(){
        $.ajax({
            url: './returnJSON_goodstu.php', //在这里提填写你的地址
            async: true,
            dataType: 'text',
            success: function (json_str) {
                var json_obj=JSON.parse(json_str);
                for(var i in json_obj){
                    names.push(i);
                    hrefs.push(json_obj[i]);
                }
                stus_good.html(
                    function(index,obj_j){
                        stus_good.eq(index).html("<a class='btn btn-default' style='width:100%;border-style:none;' href='"+hrefs[index]+"'><span class='glyphicon glyphicon-user pull-left'></span>"+names[index]+"</a>");
                    }
                );
            }  
        });
    }
    
    suggestStu();
    
    
    //想说的话
    var word_panel=$('#chart3 ul.list-group li.list-group-item');
    var names=new Array();
    var words=new Array();
    var size=0;
    //<i class='fa  fa-female'></i>&emsp;老师课讲得不错
    
    function wantToSay(){
        $.ajax({
            url: './returnJSON_word.php', //在这里提填写你的地址
            async: true,
            dataType: 'text',
            success: function (json_str) {
                size=0;
                var json_obj=JSON.parse(json_str);
                for(var i in json_obj){
                    names.push(i);
                    words.push(json_obj[i]);
                    size++;
                }
                word_panel.html(
                    function(index,obj_j){
                        if(index<size){
                            word_panel.eq(index).html("<span class='glyphicon glyphicon-user'></span>"+names[index]+":&emsp;"+words[index]);
                        }
                        else{
                            word_panel.eq(index).html("<span class='glyphicon glyphicon-user'></span>:&emsp;还未评论");
                        }
                    }
                );
            }  
        });
    }
    
    wantToSay();
            
</script>

</body>

</html>