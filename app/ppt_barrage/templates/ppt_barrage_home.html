<!doctype html>
<html lang="en">

<head>
	<title>ppt show</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<!-- VENDOR CSS -->
	<link rel="stylesheet" href="static/vendor/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="static/vendor/font-awesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="static/vendor/linearicons/style.css">
	<!-- MAIN CSS -->
	<link rel="stylesheet" href="static/css/main.css">
	<!-- FOR DEMO PURPOSES ONLY. You should remove this in your project -->
	<link rel="stylesheet" href="static/css/demo.css">
	<!-- GOOGLE FONTS -->
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet">
	<!-- ICONS -->
	<link rel="apple-touch-icon" sizes="76x76" href="static/img/apple-icon.png">
	<link rel="icon" type="image/png" sizes="96x96" href="static/img/favicon.png">


	<style>

	#danmuarea {
		position: relative;
		<!--background-image:url('static/img/1.jpg');-->
		no-repeat top left scroll;
		background-size:contain;
		width:791px;
		height: 445px;
		margin-left: auto;
		margin-right: auto;



	}



	.ctr {
		font-size: 1em;
		  line-height: 2em;
	}

    button{
           margin: -2px;
        }

	</style>


</head>

<body>
	<!-- WRAPPER -->
	<div id="wrapper">
		<!-- NAVBAR -->
		<nav class="navbar navbar-default navbar-fixed-top">
			<div class="brand">
				<a href="index.html"><img src="static/img/logo-dark.png" alt="Klorofil Logo" class="img-responsive logo"></a>			</div>
			<div class="container-fluid">
				<div class="navbar-btn">
					<button type="button" class="btn-toggle-fullwidth"><i class="lnr lnr-arrow-left-circle"></i></button>
				</div>
				<form class="navbar-form navbar-left">
				</form>
				<div class="navbar-btn navbar-btn-right">
					<a class="btn btn-success update-pro" href="#downloads/klorofil-pro-bootstrap-admin-dashboard-template/?utm_source=klorofil&utm_medium=template&utm_campaign=KlorofilPro" title="Upgrade to Pro" target="_blank"><i class="fa fa-rocket"></i> <span>UPGRADE TO PRO</span></a>				</div>
				<div id="navbar-menu">
					<ul class="nav navbar-nav navbar-right">
						<li class="dropdown">
							<a href="#" class="dropdown-toggle icon-menu" data-toggle="dropdown">
								<i class="lnr lnr-alarm"></i>
								<span class="badge bg-danger">5</span>							</a>
							<ul class="dropdown-menu notifications">
								<li><a href="#" class="notification-item"><span class="dot bg-warning"></span>System space is almost full</a></li>
								<li><a href="#" class="notification-item"><span class="dot bg-danger"></span>You have 9 unfinished tasks</a></li>
								<li><a href="#" class="notification-item"><span class="dot bg-success"></span>Monthly report is available</a></li>
								<li><a href="#" class="notification-item"><span class="dot bg-warning"></span>Weekly meeting in 1 hour</a></li>
								<li><a href="#" class="notification-item"><span class="dot bg-success"></span>Your request has been approved</a></li>
								<li><a href="#" class="more">See all notifications</a></li>
							</ul>
						</li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="lnr lnr-question-circle"></i> <span>Help</span> <i class="icon-submenu lnr lnr-chevron-down"></i></a>
							<ul class="dropdown-menu">
								<li><a href="#">Basic Use</a></li>
								<li><a href="#">Working With Data</a></li>
								<li><a href="#">Security</a></li>
								<li><a href="#">Troubleshooting</a></li>
							</ul>
						</li>
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown"><img src="static/img/user.png" class="img-circle" alt="Avatar"> <span>Samuel</span> <i class="icon-submenu lnr lnr-chevron-down"></i></a>
							<ul class="dropdown-menu">
								<li><a href="#"><i class="lnr lnr-user"></i> <span>My Profile</span></a></li>
								<li><a href="#"><i class="lnr lnr-envelope"></i> <span>Message</span></a></li>
								<li><a href="#"><i class="lnr lnr-cog"></i> <span>Settings</span></a></li>
								<li><a href="#"><i class="lnr lnr-exit"></i> <span>Logout</span></a></li>
							</ul>
						</li>
						<!-- <li>
							<a class="update-pro" href="#downloads/klorofil-pro-bootstrap-admin-dashboard-template/?utm_source=klorofil&utm_medium=template&utm_campaign=KlorofilPro" title="Upgrade to Pro" target="_blank"><i class="fa fa-rocket"></i> <span>UPGRADE TO PRO</span></a>
						</li> -->
					</ul>
				</div>
			</div>
		</nav>
		<!-- END NAVBAR -->
		<!-- LEFT SIDEBAR -->
		<div id="sidebar-nav" class="sidebar">
			<div class="sidebar-scroll">
				<nav>
					<ul class="nav">
						<li><a href="index.html" class=""><i class="lnr lnr-home"></i> <span>Dashboard</span></a></li>
						<li><a href="elements.html" class="active"><i class="lnr lnr-code"></i> <span>Elements</span></a></li>
						<li><a href="charts.html" class=""><i class="lnr lnr-chart-bars"></i> <span>Charts</span></a></li>
						<li><a href="panels.html" class=""><i class="lnr lnr-cog"></i> <span>Panels</span></a></li>
						<li><a href="notifications.html" class=""><i class="lnr lnr-alarm"></i> <span>Notifications</span></a></li>
						<li>
							<a href="#subPages" data-toggle="collapse" class="collapsed"><i class="lnr lnr-file-empty"></i> <span>Pages</span> <i class="icon-submenu lnr lnr-chevron-left"></i></a>
							<div id="subPages" class="collapse ">
								<ul class="nav">
									<li><a href="page-profile.html" class="">Profile</a></li>
									<li><a href="page-login.html" class="">Login</a></li>
									<li><a href="page-lockscreen.html" class="">Lockscreen</a></li>
								</ul>
							</div>
						</li>
						<li><a href="tables.html" class=""><i class="lnr lnr-dice"></i> <span>Tables</span></a></li>
						<li><a href="typography.html" class=""><i class="lnr lnr-text-format"></i> <span>Typography</span></a></li>
						<li><a href="icons.html" class=""><i class="lnr lnr-linearicons"></i> <span>Icons</span></a></li>
					</ul>
				</nav>
			</div>
		</div>
		<!-- END LEFT SIDEBAR -->
		<!-- MAIN -->
		<div class="main">
			<!-- MAIN CONTENT -->
			<div class="main-content">
				<div class="container-fluid">

					<div class="row">

						<div class="col-md-2" >
                            <div style="height:40px;width: 100%;margin-top: 10px;margin-bottom: 10px">
                                <span style="font-size: 25px">Choose ppt</span>
                                <a>
                                    <button  onclick="foldAdd()"><</button>
                                    <button  onclick="foldSub()">></button>
                                </a>

                            </div>

                            <div style="width:100%;height:450px;background-color:white;margin-top:0px;" id="a">


							</div>
                            <div style="height: 30px;width: 100%;margin-top: 10px">

                            </div>
						</div>

						<div class="col-md-8" >
							<div style="width:100%;height: 650px;">
								<!--添加弹幕-->
								<div id="danmu" >
								<div class="background-picture" style="width:100%;height:650px;background-size: 100% 100%;
		background-repeat: no-repeat;  background-image:url(static/img/5.jpg)"  id="ppt_hold">
		<div class="col-md-6" style="width=50%;height:650px;float:left" >
			<button id="pic_left" style="height:650px;width:100%;background:none;border:none;outline:none" onclick="picChangeLeft(this)"></button>
		</div>
		<div class="col-md-6" style="width:50%;height:650px;float:left" >
			<button id="pic_right" style="height:650px;width:100%;background:none;border:none;outline:none" onclick="picChangeRight(this)"></button>
		</div>
	</div>


								</div>

                                <div style="height: 40px;line-height: 40px;text-align: center;position: absolute;top: 650px;left: 45%;">
                                    <button style="width: 22px;height: 25px;line-height: 10px;text-align: center" onclick="picChangeLeft(this)">< </button>
                                    <div class="ipt-box" style="display:inline-block">
                                        <input type="text" value="1" style="width: 41px;height: 22px;line-height: 25px;font-size: 10px;border: 1px solid #d1ded9;outline: 0px;text-align: center;margin-right: 1px;">
                                        <span class="total_page">/&nbsp;9</span>
                                    </div>
                                    <button style="width: 22px;height: 25px;line-height: 10px;text-align: center" onclick="picChangeRight(this)"> ></button>
                                </div>


                                <div class="text-center ctr" style="position: absolute;top:690px;margin: 5px;">
                                    <button type="button"  onclick="resumer() ">开始</button>&nbsp;
                                    <button type="button"  onclick="showBarrage() ">重放</button>
                                    <button type="button"  onclick="pauser()">暂停</button>  &nbsp;&nbsp;&nbsp;&nbsp;
                                    开关:<input type='checkbox' checked='checked' id='ishide' value='is' onchange='changehide()'> &nbsp;&nbsp;&nbsp;&nbsp;
                                    透明度:<input type="range" name="op" id="op" onchange="op()" value="50">
                                    <select  name="color" id="color" >
                                        <option value="white">白色</option>
                                        <option value="red">红色</option>
                                        <option value="green">绿色</option>
                                        <option value="blue">蓝色</option>
                                        <option value="yellow">黄色</option>
                                    </select>
                                    <select name="size" id="text_size" >
                                        <option value="1">大文字</option>
                                        <option value="0">小文字</option>
                                    </select>
                                    <select name="position" id="position"   >
                                        <option value="0">滚动</option>
                                        <option value="1">顶端</option>
                                        <option value="2">底端</option>
                                    </select>
                                    <input type="textarea" id="text" max=300 />
                                    <button type="button"  onclick="send()">发送</button>
                                </div>
							</div>
						</div>
						<div class="col-md-2" style="padding-left:16px;padding-right: -10px" >
                            <div>
                                <h3> barrage-list</h3>
                            </div>
							<div  id="div1" style="width:80%;height:450px;background-color:white;margin-top:0px;overflow-y:auto">
								<p id="danmu_list" style="text-align:left;	word-wrap: break-word;word-break: break-all"></p>
							</div>
						</div>
					</div>

				</div>
			</div>
			<!-- END MAIN CONTENT -->
		</div>
		<!-- END MAIN -->
		<div class="clearfix"></div>
	</div>

	<!-- END WRAPPER -->
	<!-- Javascript -->
	<script src="static/vendor/jquery/jquery.min.js"></script>
	<script src="static/vendor/bootstrap/js/bootstrap.min.js"></script>
	<script src="static/vendor/jquery-slimscroll/jquery.slimscroll.min.js"></script>
	<script src="static/scripts/klorofil-common.js"></script>
	<!--添加js文件-->
	<script src="static/js/jquery-1.11.1.min.js"></script>
	<script src="static/js/bootstrap.js"></script>
	<script src="static/js/headroom.min.js"></script>
	<script src="static/js/jQuery.headroom.min.js"></script>
	<script src="static/js/template.js"></script>
	<script src="static/js/highlight/highlight.pack.js"></script>
	<script src="static/js/jquery.danmu.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
<script>
//添加js文件--



(function(){
$("#danmu").danmu({
	// left:$("#danmuarea").offset().left,
	// top:$("#danmuarea").offset().top,
	// height: 445,
 //    width: 800,
	left:0,
	top:0,
	height:"100%",
	width:"100%",
    speed:30000,
    opacity:1,
    font_size_small:16,
    font_size_big:24,
      top_botton_danmu_time:6000
}
  );
})(jQuery);


query();
timedCount();


var first=true;

function timedCount()
{
   $("#time").text($('#danmu').data("nowtime"));

t=setTimeout("timedCount()",50)

}



function starter(){

  $('#danmu').danmu('danmu_start');

}
function pauser(){

  $('#danmu').danmu('danmu_pause');
}
function resumer(){

  $('#danmu').danmu('danmu_resume');
}
function stoper(){
  $('#danmu').danmu('danmu_stop');
}

function getime(){
  alert($('#danmu').data("nowtime"));
}

function getpaused(){
  alert($('#danmu').data("paused"));
}

function add(){
var newd=
{ "text":"new2" , "color":"green" ,"size":"1","position":"0","time":60};

  $('#danmu').danmu("add_danmu",newd);
}
function insert(){
  var newd= { "text":"new2" , "color":"green" ,"size":"1","position":"0","time":50};
  str_newd=JSON.stringify(newd);
  $.post("stone.php",{danmu:str_newd},function(data,status){alert(data)});
}
function query() {
  $.get("query.php",function(data,status){
     var danmu_from_sql=eval(data);
     for (var i=0;i<danmu_from_sql.length;i++){
      var danmu_ls=eval('('+danmu_from_sql[i]+')');
      $('#danmu').danmu("add_danmu",danmu_ls);
     }
  });
}

function ajaxSendBarrage(text,barrage_time) {
        var file_path = $('#ppt_hold').css('background-image')
        var splits = file_path.split('/')
        var ppt_name = splits[splits.length-2]
        var data = {
        "text": text,
        "time": barrage_time,
        "ppt_name":ppt_name
        }
        $.ajax({
        type: 'POST',
        url: './api/ppt_barrage',
        async: false,
        data: data,
        dataType: 'json',
        });
        }

function ajaxShowDbBarrage() {
    var file_path = $('#ppt_hold').css('background-image')
    var splits = file_path.split('/')
    var ppt_name = splits[splits.length-2]
    var data = {
    "ppt_name":ppt_name
    }
        $.ajax({
        type: 'POST',
        url: './api/ppt_barrage/db',
        async: false,
        data: data,
        dataType: 'json',
        success: function(data) {
{#        var a = JSON.parse(data);#}
{#        document.write(JSON.parse(data))#}
{#            document.write(data['path'])#}
{#            document.write(data['path'])#}
            var barrages = data['barrages'];
            for(var barrage in barrages){
{#                document.write(barrages[barrage].barrage_text);#}
                var barrage_text = barrages[barrage].barrage_text;
                var barrage_time = barrages[barrage].barrage_time;
                var oPNode = document.getElementById('danmu_list');//获取p节点的对象
                var node = document.createElement('p');//创建一个文本节点
                node.innerHTML = barrage_time+"&nbsp;&nbsp;&nbsp;&nbsp;"+barrage_text;//文本内容
                oPNode.appendChild(node);//将创建的文本内容插入到p节点中,追加方式
                showDbBarrage(barrage_text);
            }
        }
        });


}

function send(){
  var text = document.getElementById('text').value;
  var color = document.getElementById('color').value;
  var position = document.getElementById('position').value;
  var time = $('#danmu').data("nowtime")+5;
  var size =document.getElementById('text_size').value;
  var text_obj='{ "text":"'+text+'","color":"'+color+'","size":"'+size+'","position":"'+position+'","time":'+time+'}';
  $.post("stone.php",{danmu:text_obj});
  var text_obj='{ "text":"'+text+'","color":"'+color+'","size":"'+size+'","position":"'+position+'","time":'+time+',"isnew":""}';
  var new_obj=eval('('+text_obj+')');
  $('#danmu').danmu("add_danmu",new_obj);
  document.getElementById('text').value='';
  var today=new Date();
  var month=today.getMonth();
  month=month>9?month:"0"+month;
  var date=today.getDate();
  date=date>9?date:"0"+date;
  var hour=today.getHours();
  hour=hour>9?hour:"0"+hour;
  var min=today.getMinutes();
  min=min>9?min:"0"+min;
  var sec=today.getSeconds();
    sec=sec>9?sec:"0"+sec;

  var s=today.getFullYear()+"-"+month+"-"+date+" "+hour+":"+min+":"+sec+" ";


  ajaxSendBarrage(text,s);
  var oPNode = document.getElementById('danmu_list');//获取p节点的对象
  var node = document.createElement('p');//创建一个文本节点
  node.innerHTML = s+"&nbsp;&nbsp;&nbsp;&nbsp;"+text ;//文本内容
  oPNode.appendChild(node);//将创建的文本内容插入到p节点中,追加方式

}


function sc()
{
var e=document.getElementById("div1")
e.scrollTop=e.scrollHeight;
}
var s=setInterval("sc()",200);





function op(){
var op=document.getElementById('op').value;
 $('#danmu').data("opacity",op);
}


function changehide() {
	var op = document.getElementById('op').value;
	op = op / 100;
	if (document.getElementById("ishide").checked) {
		jQuery('#danmu').data("opacity", op);
		jQuery(".flying").css({
			"opacity": op
		});
	} else {
		jQuery('#danmu').data("opacity", 0);
		jQuery(".flying").css({
			"opacity": 0
		});
	}
}


function settime(){
	var t=document.getElementById("set_time").value;
	t=parseInt(t)
	console.log(t)
	$('#danmu').data("nowtime",t);
}
	</script>
<script>
    var folds_size = 0;
    /*
    PPT页数向左翻页
     */
function picChangeLeft(which) {
    var ppt_hold = document.getElementById('ppt_hold');
    var title = ppt_hold.getAttribute('title');
    var pic_num = parseInt(title);
    if(pic_num - 1 < 0){
        pic_num = 0;
    }
    else{
        pic_num -= 1;
    }
    ppt_hold.setAttribute('title',pic_num.toString());
    var url_path = $('#ppt_hold').css('background-image');
    var oppo_path = url_path.match('ppt_barrage/(.*?)"')[1];
    oppo_path = oppo_path.replace(/[0-9]\d*.jpg/,pic_num.toString() + '.jpg');
    var command = './' + oppo_path;
    command = 'url("' + command + '")';
    $('#ppt_hold').css('background-image',command);
}
    /*
    PPT页数向右翻页
     */
function picChangeRight(which) {
    var ppt_hold = document.getElementById('ppt_hold');
    var title = ppt_hold.getAttribute('title');
    var pic_num = parseInt(title);
    if(pic_num + 1 >= folds_size){
        pic_num = folds_size-1;
    }
    else{
        pic_num +=1 ;
    }

    ppt_hold.setAttribute('title',pic_num.toString());
    var url_path = $('#ppt_hold').css('background-image');
    var oppo_path = url_path.match('ppt_barrage/(.*?)"')[1];
    oppo_path = oppo_path.replace(/[0-9]\d*.jpg/,pic_num.toString() + '.jpg');
    var command = './' + oppo_path;
    command = 'url("' + command + '")';
    $('#ppt_hold').css('background-image',command);
}
        var path;
        var files_number;
        var obj_data;
        function ajaxTest(filename) {
            var data = {
            "filename": filename
            }
        $.ajax({
        type: 'POST',
        url: './api/info_file',
        async: false,
        data: data,
        dataType: 'json',
        success: function(data) {
{#        var a = JSON.parse(data);#}
{#        document.write(JSON.parse(data))#}
{#            document.write(data['path'])#}
{#            document.write(data['path'])#}
            obj_data = data

        }
        });
        }
            var filename_and_number = {};
            var ppt_catalog_num = 1;
            var ppt_catalog_total ;
            var ppt_catalog = document.getElementById('a');
            var folds = {{ folds|safe }};
            if (folds.length%5==0){
                ppt_catalog_total = folds.length/5;
            }
            else{
                ppt_catalog_total = Math.floor(folds.length/5) + 1;
            }
            var ul_array = [];
            var result = [];
            for(var i=0,len=folds.length;i<len;i+=5){
                result.push(folds.slice(i,i+5));
            }
            for (var i = 0 ; i < result.length;i++){
                var div_list = document.createElement('div');
                for ( var j = 0 ; j < result[i].length;j++){
                    var the_p = document.createElement('button');
                    var text = document.createTextNode(result[i][j].toString());
                    ajaxTest(result[i][j].toString());
                    path = obj_data['path']
                    files_number = obj_data['number']
                    var file_name = obj_data['filename']
                    filename_and_number[file_name] = obj_data[file_name]
                    the_p.setAttribute('href',path);
                    the_p.setAttribute("style","width:100%;border:0;height:50px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap");
{#                    if(button.innerHTML.length>=10){#}
{#                        button.innerHTML.slice(0,9)='...';alert(button.innerHTML);#}
{#                    }#}

                    the_p.onclick = function (){
                        choosePPT(this);
                    };
                    the_p.appendChild(text);
                    div_list.appendChild(the_p);
                }
                ul_array.push(div_list);
            }
            ppt_catalog.appendChild(ul_array[1])

    </script>
    <script>

         function choosePPT(which) {
             var file_path = which.getAttribute('href');
             var splits = file_path.split('/');
             var filename = splits[splits.length-1];
             folds_size = filename_and_number[filename];
             var set_path = file_path.toString() + '/0.jpg';
             var command = 'url(' + set_path + ')';
             $('#ppt_hold').css('background-image',command);
             var ppt_hold = document.getElementById('ppt_hold');
             ppt_hold.setAttribute('title',1);
             $('#danmu_list').empty();
             ajaxShowDbBarrage();
         }
         function showDbBarrage(barrage_text){
            var text = barrage_text;
            var color = document.getElementById('color').value;
            var position = document.getElementById('position').value;
            var time = $('#danmu').data("nowtime")+5;
            var size =document.getElementById('text_size').value;
            var text_obj='{ "text":"'+text+'","color":"'+color+'","size":"'+size+'","position":"'+position+'","time":'+time+'}';
{#            $.post("stone.php",{danmu:text_obj});#}
            var text_obj='{ "text":"'+text+'","color":"'+color+'","size":"'+size+'","position":"'+position+'","time":'+time+',"isnew":""}';
            var new_obj=eval('('+text_obj+')');
            $('#danmu').danmu("add_danmu",new_obj);
         }

         function showBarrage() {
             $('#danmu_list').empty();
             ajaxShowDbBarrage();
         }


         function foldAdd() {
                if (ppt_catalog_num + 1 == ppt_catalog_total){
                    ppt_catalog_num = ppt_catalog_num;
                }
                else{
                    ppt_catalog_num += 1;
                }
                var a = document.getElementById('a');
                $('#a').empty();
                a.appendChild(ul_array[ppt_catalog_num]);
                var btn=document.getElementByTagName('button');
                 //btn.setAttribute('height','150px');

            }
        function foldSub() {
            if (ppt_catalog_num - 1 < 0){
                ppt_catalog_num = ppt_catalog_num;
            }
            else{
                ppt_catalog_num -= 1;
            }
            var a = document.getElementById('a');
            $('#a').empty()
            a.appendChild(ul_array[ppt_catalog_num]);
        }
    </script>
</body>
</html>